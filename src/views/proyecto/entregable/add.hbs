<!--
<div class="main" id="contenido">

  <div class="card-body">
    <form action="/entregable/add" method="POST">


      <input type="hidden" name="id_proyecto" value="{{id_proyecto}}">

      <table id="elementos" class="table">
        <thead>
          <tr>
            <th scope="col">Entregable</th>
            <th scope="col">Cantidad</th>
          </tr>
        </thead>
        <tr>

          <td>

            <select name="id_entregable" required id="entregable">
              {{#each entregables}}
              <option value="{{id_entregable}}">{{nombre}}</option>
              {{/each}}
            </select>
          </td>
          <td><input type="number" min="1" max="4" class="form-control" name="cantidad" required></td>

        </tr>

      </table>

      <p>
        <input type="button" onclick="insRow('elementos')" value="agregar nuevo">
        <td><input type="button" value="Eliminar Ultimo" onclick="deleteRow('elementos')"></td>
      </p>




      <div class="col-md-4 mx-auto">
        <div class="card">
          <div class="form-group">
            <button class="btn btn-success btn-block"> Agregar</button>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>
</div>
</div>
</div>
</div>

<script>
  function deleteRow(id) {
    document.getE
    var ultimo = document.getElementById("elementos").rows.length - 1;
    if (ultimo > 1) {
      document.getElementById(id).deleteRow(ultimo);
    }
  }

  function borrar(valor) {

    var sel = document.getElementById(valor);

    sel.remove(sel.selectedIndex);
    console.log(sel.length);

  }
  var contador = 1;
  function insRow(id) {
    var nomselect = "entregable" + contador;

    var filas = document.getElementById("elementos").rows.length;
    var combo = document.getElementById("entregable");
    var seleccionado = document.getElementById("entregable").selectedIndex;

    var total = combo.length;
    //var texto=combo.options[seleccionado].text;
    //var va=combo.options[seleccionado].value;

    contador++;
    console.log(nomselect);


    var nuevo = [];
    for (i = 0; i < total; i++) {
      if (i != seleccionado) {
        const newEntregable = {
          id_entregable: combo.options[i].value,
          nombre: combo.options[i].text
        };
        nuevo.push(newEntregable);
      }

    }
    console.log(nuevo);

    var x = document.getElementById(id).insertRow(filas);
    var y = x.insertCell(0);
    var z = x.insertCell(1);


    y.innerHTML = '<td> <select name="id_entregable" id="entregable" required>{{#each entregables}}<option value="{{id_entregable}}">{{nombre}}</option> {{/each}}</select></td>';
    z.innerHTML = '<td><input type="number" min="1" max="4"    class="form-control" name="cantidad" required></td>';

  }
</script>





!-->











<div class="main" id="contenido">
  <!--  <div class="row">
        <div class="col-md-4 mx-auto">
            <div class="card">!-->
  <div class="card-body">
    <form action="/entregable/add" method="POST">

      <div class="form-group">
        <input type="hidden" name="id_proyecto" value="{{id_proyecto}}">

        <select hidden name="entregables" id="entregables">
          {{#each entregables}}
          <option value="{{id_entregable}}">{{nombre}}</option>
          {{/each}}
        </select>
      </div>
      <div class="form-group">
        <label for="state_id" class="control-label">Añadir informes</label>
        <!-- Boton Agregar -->
        <input class="btn btn-secondary btn-sm" type="button" title="Agregar Producto" Value="+"
          onclick="agregar('elementos')">
        <!-- Boton Borrar -->
        <input id="eliminar" class="btn btn-secondary btn-sm" type="button" title="Borrar Producto" Value="-" disabled
          onclick="borrar('elementos')">
        <br>
        <br>
      </div>


      <table id="elementos" class="table">
        <thead>
          <tr>
            <th scope="col">Entregable</th>
            <th scope="col">Cantidad</th>


          </tr>
        </thead>


      </table>






      <div class="col-md-4 mx-auto">
        <div class="card">
          <div class="form-group">
            <button id="botonenviar" class="btn btn-success btn-block" onclick="activar()" disabled> Agregar</button>
          </div>
        </div>
      </div>
    </form>
  </div>




  <script>

    var options = [

    ];
    var boton = document.getElementById("botonenviar");
    var boton1 = document.getElementById("eliminar");
    var inicio = document.getElementById('entregables');

    var incremento = 0;
    var validacion = true;


    function cargarEntregables() {
      if (incremento == 0 && options.length==0) {
        for (i = 0; i < inicio.length; i++) {
          options.push([inicio.options[i].value, inicio.options[i].text]);
        }

      }


    }

    function removeItemFromArr(arr, item) {
      var valor = -1;
      for (i = 0; i < arr.length; i++) {
        if (arr[i][0] == item[0] && arr[i][1] == item[1]) {

          // console.log(i);
          valor = i;
          break;

        }

      }
      if (valor !== -1) {
        arr.splice(valor, 1);
      }
      //  console.log(arr);
    }

    function borrar(id) {

      console.log("antes de borrar", options.length);
      var ultimo = document.getElementById("elementos").rows.length - 1;

      if (ultimo > 1) {





        incremento--;
        document.getElementById(id).deleteRow(ultimo);
        var a_s = document.getElementById("entregable" + incremento);
        var texto = [a_s.options[a_s.selectedIndex].value, a_s.options[a_s.selectedIndex].text];
        options.push(texto);
        a_s.removeAttribute("disabled");

      }
      if (ultimo == 1) {
        incremento--;
        document.getElementById(id).deleteRow(ultimo);
        boton.setAttribute("disabled", "true");
        boton1.setAttribute("disabled", "true");

      }
      console.log("despues de borrar", options.length);

    }

    function añadirNuevo(id) {
      console.log("antes de añadir", options.length);
      if (incremento == 1) {

        var filas = document.getElementById("elementos").rows.length;
        var x = document.getElementById(id).insertRow(filas);
        var y = x.insertCell(0);
        var z = x.insertCell(1);

        var id_e = "entregable" + incremento;
        var can = "cantidad" + incremento;

        var opciones = "";
        for (var i = 0; i < options.length; i++) {
          //console.log(options[i][1],i);
          opciones += "<option value=" + options[i][0] + ">" + options[i][1] + "</option>";
        }


        y.innerHTML = "<td> <select  " + "class=" + "custom-select custom-select-sm-1 mb-3 " + "  name=" + " id_entregable " + "id=" + id_e + " required>" + opciones + "</select></td>";



        z.innerHTML = "<td><input type=" + "number" + "  min=" + "1" + " max=" + "4" + " class=" + "form-control" + " name=" + " cantidad " + "id= " + can + "  required></td>";

        boton.removeAttribute("disabled");
        boton1.removeAttribute("disabled");
      }

      if (incremento > 1) {


        //validar anterior tenga datos


        var cant_a = document.getElementById("cantidad" + (incremento - 1)).value;
        if (cant_a === "") {
          incremento--;
          alert("Rellene los campos");
        } else {





          var filas = document.getElementById("elementos").rows.length;
          var x = document.getElementById(id).insertRow(filas);
          var y = x.insertCell(0);
          var z = x.insertCell(1);

          var id_e = "entregable" + incremento;
          var can = "cantidad" + incremento;

          var idAnterior = "entregable" + (incremento - 1);
          selecAnterior = document.getElementById(idAnterior);

          var texto = [selecAnterior.options[selecAnterior.selectedIndex].value, selecAnterior.options[selecAnterior.selectedIndex].text];



          removeItemFromArr(options, texto);
          selecAnterior.setAttribute("disabled", "true");


          var opciones = "";
          for (var i = 0; i < options.length; i++) {
            // console.log(options[i][1],i);
            opciones += "<option value=" + options[i][0] + ">" + options[i][1] + "</option>";
          }


          y.innerHTML = "<td> <select  " + "class=" + "custom-select custom-select-sm-1 mb-3 " + "  name=" + " id_entregable " + "id=" + id_e + " required>" + opciones + "</select></td>";



          z.innerHTML = "<td><input type=" + "number" + "  min=" + "1" + " max=" + "4" + " class=" + "form-control" + " name=" + " cantidad " + "id= " + can + "  required></td>";


        }
      }
      console.log("despues de añadir",options.length);
    }


    function agregar(id) {

      cargarEntregables();
      //console.log(options);
      //console.log(incremento);
      if (incremento < inicio.length) {

        incremento++;

        añadirNuevo(id);
      }


    }



    function activar() {
      console.log(incremento);
      for (i = 1; i <= incremento; i++) {
        var a = document.getElementById("entregable" + i);
        var b = document.getElementById("cantidad" + i);

        a.removeAttribute("disabled");
        b.removeAttribute("disabled");


      }


    }

  </script>
  <!-- Bootstrap 4.0 -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  </footer>
</div>