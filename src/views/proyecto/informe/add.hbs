{{!-- LIDER -> AGREGAR INFORME --}}

{{!-- Este div ajusta el contenido para que no interfiera con la barra. --}}
<div class="main" id="contenido">

  {{!-- Este div permite ocupar el 100% del espacio vertical disponible --}}
  <div class="container-fluid">

    {{!-- div centra horizontalmente el contenido --}}
    <div class="d-flex justify-content-center vh-100">

      {{!-- div centra verticalmente el contenido --}}
      <div class="my-auto w-30" align="center">

        {{!-- Cabecera --}}
        <div class="m-5" align="center">
          <h1> Agregar Informes </h1>
        </div>

        {{!-- Campos para anadir integrante --}}
        <form action="/informe/add" method="POST">

          <div class="col" align="center">

            <input type="hidden" id="informes" value="{{agregados}}">

            <div class="form-group">

              {{#each proyecto }}
              <input type="hidden" id="creado" value="{{creado}}">

              <label>Proyecto</label>
              <input type="text" value="{{titulo}}" class="form-control mb-5" name="titulo" disabled>
              <input type="hidden" name="id_proyecto" value="{{id_proyecto}}">
              {{/each}}

            </div>

            {{!-- Botones --}}
            {{!-- <div class="form-group">
              <label for="state_id" class="control-label"> Añadir informes </label><br>

              <!-- Boton Agregar -->
              <button class="btn btn-outline-success btn-sm" onclick="insRow('elementos')"><i
                  class="fas fa-plus"></i></button>

              <!-- Boton Borrar -->
              <button class="btn btn-outline-danger btn-sm" onclick="deleteRow('elementos')"><i
                  class="fas fa-minus"></i></button> --}}


              <div class="form-group">
                <label for="state_id" class="control-label">Añadir informes</label>
                <!-- Boton Agregar -->
                <input class="btn btn-secondary btn-sm" type="button" title="Agregar Producto" Value="+"
                  onclick="insRow('elementos')">
                <!-- Boton Borrar -->
                <input id="eliminar" class="btn btn-secondary btn-sm" type="button" title="Borrar Producto" Value="-"
                  onclick="deleteRow('elementos')" disabled>
                <br>
                <br>
              </div>


            </div>

            <table id="elementos" class="table table-sm table-bordered table-striped table-hover mt-5">
              <thead>
                <tr>
                  <th scope="col">No de informe</th>
                  <th scope="col">fecha de inicio</th>
                  <th scope="col">fecha de fin</th>

                </tr>
              </thead>

            </table>

            <div class="form-group">
              <button class="btn btn-outline-primary btn-block" id="botonenviar" onclick="activar()" disabled><i
                  class="fas fa-user-plus"></i>&emsp;Crear integrante
              </button>

            </div>

          </div>

        </form>

      </div>
    </div>
  </div>
</div>

{{!-- Comienza el Script --}}
<script>
  var boton = document.getElementById("botonenviar");
  var boton1 = document.getElementById("eliminar");
  var incremento = 0;
  var validacion = true;
  function deleteRow(id) {
    if (incremento == 1) {

      boton1.setAttribute("disabled", "true");

    }
    console.log("ddd", incremento);

    var ultimo = document.getElementById("elementos").rows.length - 1;
    console.log("dsaa", ultimo);
    if (ultimo > 1) {
      incremento--;
      document.getElementById(id).deleteRow(ultimo);

    }
    if (ultimo == 1) {
      incremento--;
      document.getElementById(id).deleteRow(ultimo);
      boton.setAttribute("disabled", "true");

    }

  }

  function insRow(id) {
    if (incremento >= 1) {

      validacion = validar();
    }
    if (validacion == true) {

      incremento++;
      boton.removeAttribute("disabled");
      boton1.removeAttribute("disabled");

      var filas = document.getElementById("elementos").rows.length;
      var x = document.getElementById(id).insertRow(filas);
      var y = x.insertCell(0);
      var z = x.insertCell(1);
      var c = x.insertCell(2);
      var id_i = "no_informe" + incremento;
      var id_fi = "fecha_inicio" + incremento;
      var id_ff = "fecha_fin" + incremento;
      //var text="<input type="+"number"+  "  class="+"form-control"+" name="+"no_informe"+ "id="+ id_i+" value="+incremento+" disabled >";

      y.innerHTML = "<input type=" + "number" + "  class=" + "form-control" + " name=" + "no_informe " + "id=" + id_i + " value=" + incremento + " disabled >";
      z.innerHTML = "<input type=" + "date" + " name=" + "fecha_inicio " + "id=" + id_fi + " required />";
      c.innerHTML = "<input type=" + "date" + " name=" + "fecha_fin " + "id=" + id_ff + "  required />";

      if (incremento == 1) {
        var date = new Date();

        var creado = new Date(document.getElementById("creado").value);
        var creado1 = creado.toISOString();
        creado1 = creado1.substring(0, 10);
        var inicio = document.getElementById(id_fi);

        inicio.min = creado1;

      }

      encadenarFechas(id_fi, id_ff);
      if (incremento > 1) {
        var anterior1 = document.getElementById("fecha_inicio" + (incremento - 1));
        var anterior = document.getElementById("fecha_fin" + (incremento - 1));

        var dato = anterior.value;

        var inicio_actual = document.getElementById(id_fi);
        inicio_actual.min = dato;
        anterior1.setAttribute("disabled", "true");;
        anterior.setAttribute("disabled", "true");;

      }
    }
  }

  function validar() {
    if (incremento >= 1) {
      var id_fi = "fecha_inicio" + incremento;
      var id_ff = "fecha_fin" + incremento;
      var f_i = document.getElementById(id_fi).value;
      var f_f = document.getElementById(id_fi).value;
      if (f_i == "" && f_f == "") { return false; }
      else {
        return true;
      }
    }
  }
  
  function encadenarFechas(fecha_inicial, fecha_final) {

    document.getElementById(fecha_inicial).onchange = function () {
      var input = document.getElementById(fecha_final);
      input.min = this.value;
    }
  }

  function activar() {
    console.log(incremento);
    for (i = 1; i <= incremento; i++) {
      var a = document.getElementById("no_informe" + i);
      var b = document.getElementById("fecha_inicio" + i);
      var c = document.getElementById("fecha_fin" + i);
      a.removeAttribute("disabled");
      b.removeAttribute("disabled");
      c.removeAttribute("disabled");

  } else {
    event.preventDefault();
  }

    }

  }

</script>
<footer>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</footer>
</div>