<div class="main">
    <div class="container-fluid mt-2">
        <div class="row">
            <div class="mx-auto">

                <div class="m-5" align="center">

                    <h2> {{proyecto.titulo}} </h2>
                    <h3>Avance</h3>
                    <br>
                    <br>
                    <div class="containerx">

                        <div class="progress-container">
                            <div class="progress" id="progress">

                            </div>

                            <div class="circle active"><i class="fas fa-folder-open"></i></div>
                            <div class="circle "><i class="far fa-file-alt"></i></div>
                            <div class="circle "><i class="fas fa-list-ul"></i> </div>
                            <div class="circle "><i class="far fa-check-circle"></i></div>
                            <div class="circle "><i class="far fa-check-circle"></i></div>
                            <div class="circle "><i class="far fa-check-circle"></i></div>
                            <div class="circle "><i class="far fa-check-circle"></i></div>
                            <div class="circle "><i class="far fa-flag"></i></div>


                        </div>


                    </div>
                </div>
                <input type="hidden" name="avance" id="avance" value="{{avance}}">
                <input type="hidden" name="estado" id="estado" value="{{estado}}">
                <input type="hidden" name="id_proyecto" id="id_proyecto" value="{{proyecto.id_proyecto}}">

                {{#if admin}}

                <div class="m-5" align="center" id="terminar">
                    <td align="center"><a href="#"
                            class="btn btn-sm btn-outline-success" onclick="ver(event)"><i
                                class="fas fa-info"></i>&ensp;Terminar Proyecto</a></td>
                </div>
                {{/if}}

            </div>
        </div>
    </div>
</div>



<script>
    window.onload = actualiza;
    const progress = document.getElementById("progress");
    const circles = document.querySelectorAll(".circle");


    function actualiza() {



        let status = parseInt(document.getElementById("estado").value);
        let currentActive = parseInt(document.getElementById("avance").value);

        if (currentActive == 7 || currentActive == 9) {
            document.getElementById("terminar").style.visibility = 'hidden';
        }

        console.log("valor", currentActive);
        if (currentActive > 8) {
            currentActive = 8;
        } else if (currentActive < 0) {
            currentActive = -1;
        }
        console.log("final", currentActive);
        circles.forEach((circle, idx) => {

            if (idx < currentActive) {

                if (status == 1) { circle.classList.add("active"); }
                if (status == 2) { circle.classList.add("atrasado"); }
                if (status == 3) { circle.classList.add("terminado"); }



            } else {
                circle.classList.remove("active");
                circle.classList.remove("atrasado");
                circle.classList.remove("terminado");


            }
        });
        //const actives = document.querySelectorAll(".active");
        // console.log(actives.length, circles.length);
        if (currentActive > 0) {
            if (status == 1) { progress.classList.add("active"); }
            if (status == 2) { progress.classList.add("atrasado"); }
            if (status == 3) { progress.classList.add("terminado"); }
            progress.style.width = ((currentActive - 1) / (circles.length - 1)) * 100 + "%";
        } else { progress.style.width = 0 + "%" }
    }

    function ver(event) {
        let avance = parseInt(document.getElementById("avance").value);
        let id_proyecto = document.getElementById("id_proyecto").value;
        if (avance == 7) {
            var r = confirm("  ¿desea marcar como terminado  el proyecto?");
            if (r == true) {
                // txt = "You pressed OK!";
                
                window.location.href = "/proyecto/terminar/"+ id_proyecto;

            } 



        } else {

 var r = confirm( " Este proyecto aun no esta terminado.\n ¿Desea marcarlo como cancelado?");
            if (r == true) {
                // txt = "You pressed OK!";
                
                window.location.href = "/proyecto/terminar/"+ id_proyecto;

            } 
        }

    }
</script>